(function(n){"use strict";var t=n.module("autoSuggestApp",[]).config(["$provide",function(n){n.decorator("$log",["$delegate","autoSuggestLogger",function(n,t){var r=n.error,u=n.log,i=function(n){return n?n:""};return n.error=function(n,u){n=i(n);u=i(u);t.autoSuggestError(n,u);r.apply(null,arguments)},n.log=function(n,r){n=i(n);r=i(r);t.autoSuggestLog(n,r);u.apply(null,arguments)},n}])}]);$(function(){var r=$("meta[name='ms.service']").first(),t,i;if(r.length&&r.attr("content")==="office.com".toLowerCase()){if(t=$("#searchForm"),i=$("#cli_shellHeaderSearchInput"),!t.length&&!i.length&&!$UniversalHeaderFooterSearchFormWrapper.length)return;t.attr("ng-controller","autoSuggestController as main");i.attr("ng-model","main.searchText").attr("ng-change","main.fireAutoSuggest()");t.append("<input type='text' id='supSuggestionHider' ng-init=\"main.tenant = 'web'\" ng-model='main.tenant'/><auto-suggest search-input-box='#cli_shellHeaderSearchInput' search-submit='#search' search-input-type='button' suggestions='main.suggestions' search-text='main.searchText' show-suggestions='main.showSuggestions' selected-item='main.selectedItem'><\/auto-suggest>");n.bootstrap($("[ng-controller='autoSuggestController as main']"),["autoSuggestApp"])}else n.bootstrap($("[ng-controller='autoSuggestController as main']"),["autoSuggestApp"])})})(angular),function(){"use strict";function n(){var n=function(n){return n?n:""},t=function(n,t,i){return{asCategory:n,asType:t,asMessage:i}},i=function(n){var t=Object.keys(n),i,r;if(window.ClientSideLogging&&window.ClientSideLogging.addEventProperty&&window.ClientSideLogging.sendEvent&&t&&t.length!==0){for(i=0;i<t.length;i++)r=t[i],window.ClientSideLogging.addEventProperty(r,n[r]);window.ClientSideLogging.sendEvent("AutoSuggest_Event")}};this.autoSuggestError=function(r,u){r=n(r);u=n(u);var f=t("error",r,u);i(f)};this.autoSuggestLog=function(r,u){r=n(r);u=n(u);var f=t("event",r,u);i(f)}}angular.module("autoSuggestApp").service("autoSuggestLogger",[n])}(),function(){"use strict";function n(n){var t="asDirective";return{restrict:"E",template:"<span class='supAutoSuggestAccessibleText' role='status' aria-live='polite'><\/span><div class='supAutoSuggestContainer' ng-show='showSuggestions' ng-cloak><ul class='supSuggestionList'><li ng-repeat='suggestion in suggestions' class='supSuggestionItem supSuggestionItemText' data-suggestionindex='{{ $index }}' data-suggestiontype='{{ suggestion.suggestionType }}'>{{ suggestion.completionText }}<\/li><\/ul><\/div>",scope:{searchText:"=",showSuggestions:"=",suggestions:"=",selectedItem:"="},link:function(i,r,u){var f=-1,e=f,y="click",p=40,w=38,d=27,g=13,nt=9,o="supSuggestionItemHighLight",tt=".supAutoSuggestContainer",b=function(){i.showSuggestions=!1;return};u.searchInputBox&&u.searchSubmit&&u.searchInputType||(n.error(t,"encountered unexpeced condition, autosuggest elements not created correclty"),b());var h=u.searchInputBox,a=u.searchSubmit,k=u.searchInputType;({button:!0,input:!0,form:!0})[k]||(n.error(t,"encountered unexpeced condition, search submit type unknown"),b());var s=$(h),it=$(".supAutoSuggestAccessibleText"),v=function(n){it.text(n)},rt=function(n){n>0?v(n+" result"+(n===1?"s":"")+" available, use up and down arrow keys to navigate."):v("")},ut=function(n){$(".supSuggestionItem").removeClass(o);n.addClass(o);i.selectedItem=n;s.focus();s.val(n.text())},ft=function(){$(".supSuggestionItem").removeClass(o);i.selectedItem=null;s.focus();s.val(i.searchText)},c=function(){e=f;$(".supSuggestionItem").removeClass(o)},l=function(n){c();n||(i.showSuggestions=!1,i.selectedItem=null);i.$digest()},et=function(){switch(k){case"form":$(a).submit();break;case"button":case"input":$(a).click()}},ot=function(n,t){return n===f?f:t===w?e===f?n:e-1:t===p?e===n?f:e+1:f};$("body").on("click keyup",function(n){var t=n.which;n.type===y&&($(n.target).attr("id")===a.replace("#","")||$(n.target).closest("form").find(tt).length)?l(!0):(t===d||t===nt||n.type===y)&&l(!1)});$(h).blur(function(){occe.pushOntoExecutionStack(function(){$(document.activeElement).prop("tagName").toLowerCase()==="iframe"&&l(!1)},this)});r.on("click",function(n){n.stopPropagation()});r.on("click",".supSuggestionItemText",function(){s.val($(this).text());$(".supSuggestionItem").removeClass(o);$(this).addClass(o);i.selectedItem=$(this);l(!0);et()});$(document).on("mouseenter",".supSuggestionItemText",function(){var n=$(this).text();v(n)});$(document).on("keydown",h,function(n){if(!i.showSuggestions){c();return}var t=i.suggestions?i.suggestions.length-1:-1;n.keyCode===p||n.keyCode===w?(n.preventDefault(),e=ot(t,n.keyCode),e===f?ft():ut($("auto-suggest[search-input-box='"+h+"']").find(".supSuggestionItemText[data-suggestionindex='"+e+"']"))):n.keyCode!==g?(c(),i.selectedItem=null):(c(),i.$digest())});i.$watchCollection("suggestions",function(n,t){if(n&&t){var i=n.length;i>0&&rt(i)}})}}}angular.module("autoSuggestApp").directive("autoSuggest",["$log",n])}(),function(){"use strict";function n(){function n(n){return{suggestionType:n.AutoSuggestionType,completionText:n.CompletionText,query:"",productCode:n.L1L3Pair.Product.Code,parentProductCode:n.L1L3Pair.Product.ParentCode,parentProductName:n.L1L3Pair.Product.ParentName,productName:n.L1L3Pair.Product.Name}}function t(t){return!t||!t.AutoSuggestionType?{completionText:"",query:"",suggestionType:"",productCode:"",productName:"",parentProductCode:"",parentProductName:""}:n(t)}return{newSuggestion:t}}angular.module("autoSuggestApp").factory("suggestionFactory",["$log",n])}(),function(){"use strict";function n(n,t,i,r){function o(t,i){return n.get(t,i)}function c(n,t,i){return{timeout:e.promise,params:{SearchTerm:n,Culture:t,Tenant:i,spellcheck:"true"}}}var s=8,u="asService",f=OOGlobal.AutoSuggestEndPoint,h={1:!1,2:!0,3:!0,4:!1},e=t.defer();o(f);this.getSuggestionList=function(n,e,l,a){function b(t){v=Date.now();var r=t.data?t.data:"no response body";return i.error(u,"autosuggest endpoint callback failed: text: '"+n+"', tenant: '"+e+"', locale: '"+l+"', responseBody: '"+r+"'', responseStatus: '"+t.status+"'', responseTime: '"+(v-p)),[]}function k(t){var b,o,c,f,y,w;if(v=Date.now(),i.log(u,"Endpoint response success time (ms): "+(v-p)),b=a||s,o=[],!t.data||!t.data.AutoSuggestions||!angular.isArray(t.data.AutoSuggestions))return i.log(u,"autosuggest returned 0 suggestions: text: '"+n+"', tenant: '"+e+"', locale: '"+l+"'"),o;for(c=t.data.AutoSuggestions,f=0;f<b&&f<c.length;)y=c[f],h[y.AutoSuggestionType]&&(w=r.newSuggestion(y),w.query=n,o.push(w)),f++;return o}var p=Date.now(),v=0,y,w;return!n||!e||!l||a<=0?(i.error(u,"getSuggestionList called with one or more bad arguments"),y=t.defer(),y.resolve([]),y.promise):(w=c(n,l,e),o(f,w).then(k,b))};this.cancelSuggestionServiceCall=function(){e.resolve("cancel request")}}angular.module("autoSuggestApp").service("autoSuggestService",["$http","$q","$log","suggestionFactory",n])}(),function(){"use strict";function n(n,t,i,r){function c(){if(!u.searchText||o){u.showSuggestions=!1;return}var e=Date.now(),t,c=r(function(){n.cancelSuggestionServiceCall();u.showSuggestions=!1;o=!0;i.error(f,"Encountered autosuggest endpoint service timeouts/slow downs. Turning off autosuggest for this request")},900);n.getSuggestionList(u.searchText,h(),OOGlobal.Culture,s).then(function(n){r.cancel(c);!!n&&angular.isArray(n)&&n.length>0?(u.suggestions=n.sort(function(n,t){return t.suggestionType-n.suggestionType}),u.showSuggestions=!0):(u.suggestions=[],u.showSuggestions=!1);t=Date.now();i.log(f,"Endpoint response and render time (ms): "+(t-e))})}var u=this,f="asController",o=!1,s,e,h;u.fireAutoSuggest=c;u.searchText;u.suggestions=[];u.showSuggestions=!1;u.tenant;s=8;h=function(){return u.tenant?!e?(e={web:"Office-Web",zol160:"Office-Outlook",zxl160:"Office-Excel",zwd160:"Office-Word",zpp160:"Office-PowerPoint"}[u.tenant.toLowerCase()],e||null):e:null};u.getAutoSuggestTags=function(){var n={};return u.selectedItem?(n["ms.searchtype"]="as",n["ms.querylength"]=u.searchText.length,n["ms.aslinkpos"]=u.selectedItem.data("suggestionindex"),n["ms.asgroup"]=u.selectedItem.data("suggestiontype"),i.log(f,"search event fired with autosuggest: searchtype: '"+n["ms.searchtype"]+"', query length: '"+n["ms.querylength"]+"', link position: '"+n["ms.aslinkpos"]+"', group type: '"+n["ms.asgroup"]+"'"),u.selectedItem=null):(n["ms.asdisplayed"]=u.showSuggestions?1:0,n["ms.searchtype"]="searchbox",i.log(f,"search event fired with auto suggest on or off: '"+n["ms.asdisplayed"]+"'")),n}}angular.module("autoSuggestApp").controller("autoSuggestController",["autoSuggestService","$scope","$log","$timeout",n])}()